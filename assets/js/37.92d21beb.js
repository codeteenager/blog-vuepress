(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{449:function(a,t,s){"use strict";s.r(t);var n=s(30),e=Object(n.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"leakcanary教程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#leakcanary教程"}},[a._v("#")]),a._v(" LeakCanary教程")]),a._v(" "),t("p",[a._v("LeakCanary是Square公司开源的一个检测内存泄漏的函数库，可以方便的在项目中集成，在Debug版本中监控Activity、Fragment等的内存泄漏。使用教程如下：")]),a._v(" "),t("h4",{attrs:{id:"leakcanary是square公司开源的一个检测内存泄漏的函数库-可以方便的在项目中集成-在debug版本中监控activity、fragment等的内存泄漏。使用教程如下"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#leakcanary是square公司开源的一个检测内存泄漏的函数库-可以方便的在项目中集成-在debug版本中监控activity、fragment等的内存泄漏。使用教程如下"}},[a._v("#")]),a._v(" LeakCanary是Square公司开源的一个检测内存泄漏的函数库，可以方便的在项目中集成，在Debug版本中监控Activity、Fragment等的内存泄漏。使用教程如下：")]),a._v(" "),t("ul",[t("li",[a._v("在你项目的gradle中添加以下依赖。")])]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("dependencies "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n   debugCompile 'com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("squareup"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("leakcanary"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("leakcanary"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("android"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.5")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v(".1")]),a._v("'\n   releaseCompile 'com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("squareup"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("leakcanary"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("leakcanary"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("android"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("no"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("op"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.5")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v(".1")]),a._v("'\n   testCompile 'com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("squareup"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("leakcanary"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("leakcanary"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("android"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("no"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("op"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.5")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v(".1")]),a._v("'\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("在上述依赖中可以看到，只有在Debug版本中才使用LeakCanary的功能，而在Release和Test版本中，使用其no-op版本，此版本没有实际代码和操作，这样不会对生成的APK包体积和应用的性能造成影响。")]),a._v(" "),t("ul",[t("li",[a._v("在Application中获取RefWatcher实例，并用RefWatcher来检测想要监控的对象。")])]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("RefWatcher")]),a._v(" refWatcher"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Override")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("onCreate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("onCreate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("LeakCanary")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("isInAnalyzerProcess")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        refWatcher "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("LeakCanary")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("RefWatcher")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getRefWatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Context")]),a._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MyApplication")]),a._v(" application "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MyApplication")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getApplicationContext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" application"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("refWatcher"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("如果只检测Activity的泄漏，只需要在Application中的onCreate()中使用LeakCanary.install(this);即可，此函数会启动一个ActivityRefWatcher，它会自动监控应用中调用Activity.onDestroy()之后发生泄漏的Activity。如果想监控其他对象例如Fragment，那就用RefWatcher的实例来实现。")]),a._v(" "),t("ul",[t("li",[a._v("使用RefWatcher来检测对象")])]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("\t"),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("RefWatcher")]),a._v(" refWatcher "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MyApplication")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getRefWatcher")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\trefWatcher"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("watch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("ul",[t("li",[a._v("LeakCanary的Github地址：https://github.com/square/leakcanary")]),a._v(" "),t("li",[a._v("LeakCanary中文使用：https://www.liaohuqiu.net/cn/posts/leak-canary-read-me/")])])])}),[],!1,null,null,null);t.default=e.exports}}]);